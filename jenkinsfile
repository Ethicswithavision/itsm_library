Terraform Cloud Dynamic AWS Credentials – EKS Standard Model

Goal:
Move all EKS Terraform workspaces from static AWS credentials to dynamic, role-based authentication using Terraform Cloud OIDC.

Why:
- Eliminate long-lived AWS access keys
- Enforce zero-trust, identity-based access
- Reduce blast radius per workspace/environment
- Enable scalable EKS lifecycle automation (create, upgrade, destroy)

Terraform Cloud Workspace Requirements:
Each EKS workspace must define the following variables:

1. TFC_AWS_PROVIDER_AUTH = true
   Purpose: Enables Terraform Cloud to authenticate to AWS using OIDC instead of access keys.

2. TFC_AWS_RUN_ROLE_ARN = arn:aws:iam::<ACCOUNT_ID>:role/<ROLE_NAME>
   Purpose: Specifies the IAM role Terraform Cloud is allowed to assume for this workspace.

IAM Role Design (per workload account):
- One EKS Terraform role per workload account and environment (not per workspace).
- Example role name:
  terraform_<SERVICE_OWNER_ID>_EKS_<ENV>

Example:
terraform_GTOE_EKS_nonprod
terraform_GTOE_EKS_prod

IAM Role Components:
1. Role
2. Permissions policy (EKS, EC2, VPC, IAM limited, ELB, ASG, CloudWatch, Logs, KMS, ECR)
3. Trust policy using Terraform Cloud OIDC provider

Trust Policy Requirements:
- Trusted entity: Terraform Cloud OIDC provider (app.terraform.io)
- Conditional access enforced by:
  - Terraform Cloud Organization
  - Terraform Cloud Project (prod / nonprod)
  - Terraform Cloud Workspace name or prefix

Workspace Naming Convention:
Workspaces must follow a predictable prefix pattern to allow conditional trust binding.

Example:
slf-eks-nonprod-app1
slf-eks-nonprod-app2

Trust condition example:
Workspace name must match: slf-eks-nonprod-*

Execution Flow:
Terraform Cloud Workspace
→ OIDC Authentication
→ Assume IAM Role (TFC_AWS_RUN_ROLE_ARN)
→ Temporary STS credentials
→ Terraform AWS Provider
→ EKS lifecycle operations

Outcome:
- No AWS access keys stored in Terraform Cloud
- Access strictly scoped to workspace, project, and environment
- Secure foundation for EKS upgrade automation and day-2 operations


Create a Mermaid diagram that explains Terraform Cloud dynamic AWS credentials for EKS.

Diagram should include:
- Terraform Cloud Workspace
- Workspace variables:
  - TFC_AWS_PROVIDER_AUTH = true
  - TFC_AWS_RUN_ROLE_ARN
- Terraform Cloud OIDC Provider (app.terraform.io)
- AWS IAM Role (terraform_<SERVICE_OWNER_ID>_EKS_<ENV>)
- Trust Policy with conditions:
  - Terraform Cloud Organization
  - Terraform Cloud Project (prod / nonprod)
  - Workspace name prefix (e.g. slf-eks-nonprod-*)
- Temporary STS credentials
- Terraform AWS Provider
- AWS EKS Cluster in a workload account

Flow to represent:
Terraform Cloud Workspace
→ OIDC authentication via app.terraform.io
→ Assume IAM Role using TFC_AWS_RUN_ROLE_ARN
→ STS temporary credentials
→ Terraform AWS Provider
→ EKS cluster lifecycle operations (create / update / upgrade / destroy)

Diagram style:
- Use flowchart or sequence diagram
- Clearly separate Terraform Cloud and AWS with subgraphs
- Label security boundaries and identity flow

